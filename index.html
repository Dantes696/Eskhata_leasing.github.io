<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Расчёт лизинга</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,sans-serif}
body{background:#f4f6fb;padding:16px}
.container{max-width:1100px;margin:auto;background:#fff;border-radius:16px;
box-shadow:0 15px 45px rgba(0,0,0,.12);padding:28px}

.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
h1{font-size:24px;color:#2c3e50}
button{padding:10px 16px;border:none;border-radius:8px;
font-size:13px;font-weight:600;cursor:pointer;background:#667eea;color:#fff}

.layout{display:flex;gap:24px}

/* ===== ВВОД ===== */
.inputs{width:300px}
.input-group{margin-bottom:14px}
label{display:block;font-size:12px;font-weight:600;margin-bottom:5px;color:#495057}
input{width:100%;padding:9px 10px;border:1px solid #ddd;border-radius:7px;font-size:13px}

/* ===== КАРТОЧКИ ===== */
.cards{
display:grid;
grid-template-columns:repeat(5,1fr);
gap:12px;
margin-bottom:18px
}
.card{
background:#f8f9fa;
border-radius:12px;
padding:14px;
text-align:center
}
.card-title{font-size:11px;color:#6c757d;margin-bottom:4px}
.card-value{font-size:18px;font-weight:700;color:#2c3e50}

/* ===== ТАБЛИЦА (TELEGRAM) ===== */
table{width:100%;border-collapse:collapse;font-size:12px}
thead{background:#2c3e50;color:#fff}
th,td{padding:6px 6px;text-align:center;border-bottom:1px solid #e6e6e6}
tbody tr:nth-child(even){background:#fafafa}

/* ===== СКРИНШОТ ===== */
.screenshot body{background:#fff}
.screenshot .container{box-shadow:none}
.screenshot .inputs,
.screenshot .header button{display:none}
</style>
</head>

<body>
<div class="container">

<div class="header">
<h1>Расчёт лизинга</h1>
<button onclick="toggleScreenshot()">Режим скриншота</button>
</div>

<div class="layout">

<!-- ===== ВВОД ===== -->
<div class="inputs">
<div class="input-group">
<label>Стоимость объекта</label>
<input id="price" value="307000000">
</div>
<div class="input-group">
<label>Аванс (%)</label>
<input id="advancePct" value="25">
</div>
<div class="input-group">
<label>Срок (мес.)</label>
<input id="term" value="36">
</div>
</div>

<!-- ===== РЕЗУЛЬТАТ ===== -->
<div style="flex:1">

<div class="cards">
<div class="card">
<div class="card-title">Сумма лизинга</div>
<div class="card-value" id="leaseSum">0</div>
</div>
<div class="card">
<div class="card-title">Аванс</div>
<div class="card-value" id="advanceSum">0</div>
</div>
<div class="card">
<div class="card-title">Общие проценты</div>
<div class="card-value" id="totalInterest">0</div>
</div>
<div class="card">
<div class="card-title">Единовременная маржа</div>
<div class="card-value" id="marginSum">0</div>
</div>
<div class="card">
<div class="card-title">Страхование (год)</div>
<div class="card-value" id="insuranceSum">0</div>
</div>
</div>

<table>
<thead>
<tr>
<th>Мес</th>
<th>Платёж</th>
<th>Долг</th>
<th>%</th>
<th>Остаток</th>
</tr>
</thead>
<tbody id="schedule"></tbody>
</table>

</div>
</div>
</div>

<script>
const REG = 876736;
const RATE = 0.2975/12;
const MARGIN_RATE = 0.03;
const INS_RATE = 0.0024;

function n(v){return parseFloat(String(v).replace(/\s/g,''))||0}
function f(x){
x=Math.round(x*100)/100;
let p=x.toString().split('.');
p[0]=p[0].replace(/\B(?=(\d{3})+(?!\d))/g,' ');
return p.length===1?p[0]+'.00':p[1].length===1?p[0]+'.'+p[1]+'0':p.join('.');
}

function annuity(a,r,t){
let res=[],bal=a,pay=a*(r*Math.pow(1+r,t))/(Math.pow(1+r,t)-1);
for(let i=1;i<=t;i++){
let intr=bal*r;
let pr=Math.min(bal,pay-intr);
bal-=pr;
res.push({m:i,p:pay,pr:pr,intr:intr,bal:Math.max(0,bal)});
}
return res;
}

function build(){
const P=n(price.value);
const A=n(advancePct.value)/100;
const T=n(term.value);

const total=P+REG;
const advance=total*A;
const lease=total-advance;
const margin=total*MARGIN_RATE;
const insurance=P*INS_RATE;

const sch=annuity(lease,RATE,T);

let intSum=0;
schedule.innerHTML="";
sch.forEach(r=>{
intSum+=r.intr;
schedule.innerHTML+=`
<tr>
<td>${r.m}</td>
<td>${f(r.p)}</td>
<td>${f(r.pr)}</td>
<td>${f(r.intr)}</td>
<td>${f(r.bal)}</td>
</tr>`;
});

leaseSum.textContent=f(lease);
advanceSum.textContent=f(advance);
totalInterest.textContent=f(intSum);
marginSum.textContent=f(margin);
insuranceSum.textContent=f(insurance);
}

function toggleScreenshot(){
document.documentElement.classList.toggle('screenshot');
}

['price','advancePct','term'].forEach(id=>{
document.getElementById(id).addEventListener('input',build);
});

build();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title data-i18n="title">Калькулятор рассрочки</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
body{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);min-height:100vh;padding:20px;display:flex;justify-content:center;align-items:flex-start}

.container{background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.15);padding:40px;max-width:1200px;width:100%;margin-top:20px}

/* HEADER */
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
.brand{display:flex;align-items:center;gap:15px}
.logo{height:50px}
h1{font-size:28px;color:#2c3e50}

.lang-switch span{cursor:pointer;font-weight:600;margin-left:12px;color:#667eea}
.lang-switch span.active{text-decoration:underline}

/* LAYOUT */
.calculator-section{display:flex;flex-wrap:wrap;gap:40px}
.input-section{flex:1;min-width:350px;padding:25px;background:#f8f9fa;border-radius:15px}
.output-section{flex:2;min-width:500px}

/* INPUTS */
.input-group{margin-bottom:20px}
label{display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:#495057}
.currency-input,.percentage-input{position:relative}
.currency-input input,.percentage-input input,input[type=number],select{
width:100%;padding:12px 15px;border:2px solid #e0e0e0;border-radius:8px;font-size:16px}
.currency-input input{padding-left:45px}
.percentage-input input{padding-right:45px}
.currency-symbol{position:absolute;left:15px;top:50%;transform:translateY(-50%);font-weight:bold}
.percentage-symbol{position:absolute;right:15px;top:50%;transform:translateY(-50%);font-weight:bold}

/* BUTTONS */
.calculate-btn,.client-btn{
width:100%;padding:16px;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;margin-bottom:10px}
.calculate-btn{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}
.client-btn{background:#2c3e50;color:#fff}

/* SUMMARY */
.summary-section{background:#fff;border-radius:15px;padding:25px;margin-bottom:30px}
.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}
.summary-item{text-align:center;padding:20px;background:#f8f9fa;border-radius:10px}
.summary-label{font-size:14px;color:#6c757d;margin-bottom:8px}
.summary-value{font-size:24px;font-weight:700;color:#2c3e50}

/* TABLE */
.results-container{background:#fff;border-radius:15px;padding:25px}
.schedule-container{max-height:none;overflow:visible;border:2px solid #e9ecef;border-radius:10px}
table{width:100%;border-collapse:collapse;font-size:14px}
thead{background:#2c3e50;color:#fff}
th,td{padding:10px;text-align:center}
tbody tr:nth-child(even){background:#fafafa}

/* CLIENT MODE */
.client body{background:#fff}
.client .input-section,
.client .calculate-btn,
.client .client-btn,
.client .lang-switch{display:none}
.client .container{box-shadow:none}

/* PRINT / PDF */
@media print{
  body{
    background:#fff;
    padding:0;
  }

  .container{
    box-shadow:none;
    margin:0;
    padding:16px;
    max-width:100%;
  }

  /* скрываем всё лишнее */
  .input-section,
  .calculate-btn,
  .client-btn,
  .lang-switch{
    display:none !important;
  }

  /* заголовок */
  h1{
    font-size:20px;
    margin-bottom:8px;
  }

  .logo{
    height:40px;
  }

  /* summary */
  .summary-section{
    padding:15px;
    margin-bottom:15px;
  }

  .summary-label{
    font-size:11px;
  }

  .summary-value{
    font-size:18px;
  }

  /* таблица */
  table{
    font-size:11px;
  }

  th, td{
    padding:4px 6px;
  }

  thead{
    background:#2c3e50 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  tbody tr:nth-child(even){
    background:#f2f2f2 !important;
  }

  /* убираем лишние отступы */
  .results-container{
    padding:0;
  }
}

</style>
</head>

<body>
<div class="container">

<div class="header">
<div class="brand">
<img src="logo.png" class="logo" alt="Eskhata Leasing">
<h1 data-i18n="title">Калькулятор рассрочки</h1>
</div>
<div class="lang-switch">
<span data-lang="ru">RU</span>
<span data-lang="uz">UZ</span>
<span data-lang="en">ENG</span>
</div>
</div>

<div class="calculator-section">

<div class="input-section">
<div class="input-group">
<label data-i18n="price">Стоимость имущества</label>
<div class="currency-input"><span class="currency-symbol">UZS</span>
<input type="text" id="price" value="265 000 000"></div>
</div>

<div class="input-group">
<label data-i18n="advance">Аванс (%)</label>
<div class="percentage-input">
<input type="text" id="advance" value="30"><span class="percentage-symbol">%</span>
</div>
</div>

<div class="input-group">
<label data-i18n="term">Срок (мес.)</label>
<input type="number" id="term" value="36">
</div>

<div class="input-group">
<label data-i18n="extra">Доп. платёж</label>
<div class="currency-input"><span class="currency-symbol">UZS</span>
<input type="text" id="extra" value="0"></div>
</div>

<div class="input-group">
<label data-i18n="type">Тип графика</label>
<select id="type">
<option value="annuity">Аннуитет</option>
<option value="decl2">Убывающий 2x</option>
<option value="decl3">Убывающий 3x</option>
<option value="linear_q">Линейный (квартальный)</option>
<option value="inst_m">Рассрочка ежемесячная</option>
<option value="inst_q">Рассрочка квартальная</option>
</select>
</div>

<button class="calculate-btn" onclick="build()" data-i18n="calc">Рассчитать</button>
<button class="client-btn" onclick="toggleClient()" data-i18n="client">Режим для клиента</button>
<button class="client-btn" onclick="window.print()" data-i18n="pdf">PDF / Печать</button>
</div>

<div class="output-section">
<div class="summary-section">
<div class="summary-grid">
<div class="summary-item"><div class="summary-label" data-i18n="lease">Сумма лизинга</div><div class="summary-value" id="outLease">0</div></div>
<div class="summary-item"><div class="summary-label" data-i18n="adv">Аванс</div><div class="summary-value" id="outAdvance">0</div></div>
<div class="summary-item"><div class="summary-label" data-i18n="over">Переплата</div><div class="summary-value" id="outOver">0</div></div>
<div class="summary-item"><div class="summary-label" data-i18n="margin">Единоразовая маржа</div><div class="summary-value" id="outMargin">0</div></div>
</div>
</div>

<div class="results-container">
<div class="schedule-container">
<table>
<thead><tr>
<th>Мес</th><th>Платёж</th><th>Тело</th><th>%</th><th>Остаток</th>
</tr></thead>
<tbody id="tbl"></tbody>
</table>
</div>
</div>
</div>

</div>
</div>

<script>
const REG=876736,RATE=0.2975/12,MARGIN_RATE=0.03;

const i18n={
ru:{title:"Калькулятор рассрочки",price:"Стоимость имущества",advance:"Аванс (%)",term:"Срок (мес.)",extra:"Доп. платёж",
type:"Тип графика",calc:"Рассчитать",client:"Режим для клиента",pdf:"PDF / Печать",
lease:"Сумма лизинга",adv:"Аванс",over:"Переплата",margin:"Единоразовая маржа"},
en:{title:"Installment Calculator",price:"Asset price",advance:"Advance (%)",term:"Term (months)",extra:"Additional payment",
type:"Schedule type",calc:"Calculate",client:"Client mode",pdf:"PDF / Print",
lease:"Lease amount",adv:"Advance",over:"Overpayment",margin:"One-time commission"},
uz:{title:"Bo‘lib to‘lash kalkulyatori",price:"Mol-mulk qiymati",advance:"Boshlang‘ich to‘lov (%)",
term:"Muddati (oy)",extra:"Qo‘shimcha to‘lov",type:"To‘lov jadvali",
calc:"Hisoblash",client:"Mijoz rejimi",pdf:"PDF / Chop etish",
lease:"Lizing summasi",adv:"Boshlang‘ich to‘lov",over:"Ortiqcha to‘lov",margin:"Bir martalik marja"}
};

function setLang(l){
document.querySelectorAll('[data-i18n]').forEach(e=>{
const k=e.dataset.i18n;if(i18n[l][k])e.textContent=i18n[l][k];
});
document.querySelectorAll('.lang-switch span').forEach(s=>s.classList.toggle('active',s.dataset.lang===l));
localStorage.setItem('lang',l);
}
document.querySelectorAll('.lang-switch span').forEach(s=>s.onclick=()=>setLang(s.dataset.lang));
setLang(localStorage.getItem('lang')||'ru');

function n(v){return parseFloat(String(v).replace(/\s/g,'').replace(',','.'))||0}
function f(x){return x.toLocaleString('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2})}

function annuity(a,r,t){
let bal=a,res=[],pay=a*(r*Math.pow(1+r,t))/(Math.pow(1+r,t)-1);
for(let i=1;i<=t;i++){let intr=bal*r,pr=Math.min(bal,pay-intr);bal-=pr;res.push([i,pay,pr,intr,Math.max(0,bal)])}
return res;
}

function build(){
  let P = n(price.value),
      A = n(advance.value) / 100,
      T = +term.value,
      E = n(extra.value);

  let total  = P + REG;
  let adv    = total * A;
  let lease  = total - adv;
  let margin = total * MARGIN_RATE;

  let sch = [];

  switch(type.value){
    case "annuity":
      sch = annuity(lease, RATE, T);
      break;

    case "decl2":
      sch = declining(lease, RATE, T, 2);
      break;

    case "decl3":
      sch = declining(lease, RATE, T, 3);
      break;

    case "linear_q":
      sch = linearQuarterly(lease, RATE, T);
      break;

    case "inst_m":
      sch = installment(lease, T, false);
      break;

    case "inst_q":
      sch = installment(lease, T, true);
      break;

    default:
      sch = annuity(lease, RATE, T);
  }

  let over = 0;
  tbl.innerHTML = "";

  sch.forEach(r => {
    if(r[3]) over += r[3];

    tbl.innerHTML += `
      <tr>
        <td>${r[0]}</td>
        <td>${r[1] != null ? f(r[1] + E) : '-'}</td>
        <td>${r[2] != null ? f(r[2]) : '-'}</td>
        <td>${r[3] != null ? f(r[3]) : '-'}</td>
        <td>${r[4] != null ? f(r[4]) : '-'}</td>
      </tr>
    `;
  });

  outLease.textContent   = f(lease);
  outAdvance.textContent = f(adv);
  outOver.textContent    = f(over);
  outMargin.textContent  = f(margin);
}


let over=0;tbl.innerHTML="";
sch.forEach(r=>{over+=r[3];tbl.innerHTML+=`<tr>
<td>${r[0]}</td><td>${f(r[1]+E)}</td><td>${f(r[2])}</td><td>${f(r[3])}</td><td>${f(r[4])}</td></tr>`});

outLease.textContent=f(lease);
outAdvance.textContent=f(adv);
outOver.textContent=f(over);
outMargin.textContent=f(margin);
}

function toggleClient(){document.documentElement.classList.toggle('client')}
build();
</script>
</body>
</html>

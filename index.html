<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Калькулятор рассрочки</title>

<style>
/* ====== ВИЗУАЛ НЕ ТРОГАЛ ====== */
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}
body{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);min-height:100vh;padding:20px}
.container{background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.15);padding:40px;max-width:1200px;margin:auto}
h1{text-align:center;margin-bottom:30px}
.calculator-section{display:flex;gap:40px;flex-wrap:wrap}
.input-section{flex:1;min-width:350px;background:#f8f9fa;padding:25px;border-radius:15px}
.output-section{flex:2;min-width:500px}
.input-group{margin-bottom:20px}
label{font-weight:600;margin-bottom:6px;display:block}
input,select{width:100%;padding:12px;border-radius:8px;border:2px solid #e0e0e0;font-size:16px}
.calculate-btn{width:100%;padding:16px;font-size:18px;border-radius:10px;border:none;color:#fff;background:linear-gradient(135deg,#667eea,#764ba2);cursor:pointer}
.summary-section{background:#fff;padding:25px;border-radius:15px;margin-bottom:25px}
.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}
.summary-item{text-align:center;background:#f8f9fa;padding:15px;border-radius:10px}
.summary-value{font-size:22px;font-weight:700}
.results-container{background:#fff;padding:25px;border-radius:15px}
table{width:100%;border-collapse:collapse}
th,td{text-align:center;padding:10px;border-bottom:1px solid #eee}
thead{background:#2c3e50;color:#fff;position:sticky;top:0}
.schedule-container{max-height:420px;overflow:auto}
</style>
</head>

<body>
<div class="container">
<h1>Калькулятор рассрочки</h1>

<div class="calculator-section">
<div class="input-section">

<div class="input-group">
<label>Стоимость имущества (UZS)</label>
<input id="totalPrice" value="265000000">
</div>

<div class="input-group">
<label>Аванс (%)</label>
<input id="advancePercent" value="30">
</div>

<div class="input-group">
<label>Срок (мес)</label>
<input id="term" type="number" value="36">
</div>

<div class="input-group">
<label>Доп. платеж (UZS)</label>
<input id="extraPayment" value="0">
</div>

<div class="input-group">
<label>Тип графика</label>
<select id="paymentType">
<option value="annuity">Аннуитет</option>
<option value="linear">Линейный</option>
<option value="declining2x">Убывающий 2x</option>
<option value="declining3x">Убывающий 3x</option>
<option value="installment_monthly">Рассрочка</option>
</select>
</div>

<button class="calculate-btn" onclick="BuildSchedule()">Рассчитать</button>

</div>

<div class="output-section">

<div class="summary-section">
<div class="summary-grid">
<div class="summary-item">
<div>Сумма лизинга</div>
<div class="summary-value" id="leasingAmount">0</div>
</div>
<div class="summary-item">
<div>Аванс</div>
<div class="summary-value" id="advanceAmount">0</div>
</div>
<div class="summary-item">
<div>Переплата</div>
<div class="summary-value" id="totalOverpayment">0</div>
</div>
</div>
</div>

<div class="results-container">
<div class="schedule-container">
<table>
<thead>
<tr>
<th>Мес</th>
<th>Платеж</th>
<th>Долг</th>
<th>%</th>
<th>Остаток</th>
</tr>
</thead>
<tbody id="scheduleBody"></tbody>
</table>
</div>
</div>

</div>
</div>
</div>

<script>
/* ===== СКРЫТЫЕ ПАРАМЕТРЫ ===== */
const ADMIN = {
  annualRate: 0.295,
  insuranceRate: 0.0024,
  marginRate: 0.03,
  registrationFee: 876736
};

/* ===== ВСПОМОГАТЕЛЬНЫЕ ===== */
const num = v => parseFloat(String(v).replace(/\s/g,'').replace(',','.'))||0;
const pct = v => { let n=num(v); return n>1?n/100:n };
const r2 = v => Math.round(v*100)/100;

/* ===== АННУИТЕТ ===== */
function annuity(A,r,n){
 let p=A*(r*Math.pow(1+r,n))/(Math.pow(1+r,n)-1),b=A,res=[];
 for(let i=1;i<=n;i++){
  let iN=b*r,pr=p-iN;
  if(i===n)pr=b;
  b-=pr;if(b<1e-6)b=0;
  res.push({m:i,p:r2(pr+iN),pr:r2(pr),i:r2(iN),b:r2(b)});
 }
 return res;
}

/* ===== ЛИНЕЙНЫЙ ===== */
function linear(A,r,n){
 let pr=A/n,b=A,res=[];
 for(let i=1;i<=n;i++){
  let iN=b*r,p=(i===n?b:pr)+iN;
  b-=i===n?b:pr;if(b<1e-6)b=0;
  res.push({m:i,p:r2(p),pr:r2(p-iN),i:r2(iN),b:r2(b)});
 }
 return res;
}

/* ===== ОСНОВНОЙ ===== */
function BuildSchedule(){
 const price=num(totalPrice.value);
 const adv=pct(advancePercent.value);
 const termN=parseInt(term.value);
 const extra=num(extraPayment.value);
 const type=paymentType.value;

 const insurance=price*ADMIN.insuranceRate;
 const margin=price*ADMIN.marginRate;

 const total=price+insurance+margin+ADMIN.registrationFee;
 const advance=total*adv;
 const lease=total-advance;

 const r=ADMIN.annualRate/12;

 let sch=[];
 if(type==='annuity') sch=annuity(lease,r,termN);
 if(type==='linear') sch=linear(lease,r,termN);
 if(type==='installment_monthly') sch=linear(lease,0,termN);

 let interest=0;
 sch.forEach(x=>{x.p+=extra;interest+=x.i});

 leasingAmount.textContent=r2(lease).toLocaleString();
 advanceAmount.textContent=r2(advance).toLocaleString();
 totalOverpayment.textContent=r2(interest).toLocaleString();

 scheduleBody.innerHTML='';
 sch.forEach(x=>{
  scheduleBody.innerHTML+=`<tr>
  <td>${x.m}</td>
  <td>${x.p.toLocaleString()}</td>
  <td>${x.pr.toLocaleString()}</td>
  <td>${x.i.toLocaleString()}</td>
  <td>${x.b.toLocaleString()}</td></tr>`;
 });
}

BuildSchedule();
</script>
</body>
</html>
